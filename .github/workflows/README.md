# GitHub Actions Workflows

æœ¬ç›®å½•åŒ…å«é¡¹ç›®çš„ CI/CD é…ç½®ã€‚

## ğŸ“‹ Workflow è¯´æ˜

### **CI - æŒç»­é›†æˆ** (`ci.yml`)

**è§¦å‘æ¡ä»¶**ï¼š
- Push åˆ° `main` åˆ†æ”¯
- åˆ›å»º/æ›´æ–° Pull Request åˆ° `main` åˆ†æ”¯

**æ£€æŸ¥é¡¹ç›®**ï¼š
- âœ… å‰ç«¯æµ‹è¯• (54 tests)
- âœ… TypeScript ç±»å‹æ£€æŸ¥
- âœ… ESLint ä»£ç æ£€æŸ¥
- âœ… æ„å»ºéªŒè¯
- âœ… è¦†ç›–ç‡ä¸Šä¼ ï¼ˆå¯é€‰ï¼‰

**å¹¶å‘æ§åˆ¶**ï¼š
- åŒä¸€ PR çš„å¤šæ¬¡ push ä¼šè‡ªåŠ¨å–æ¶ˆä¹‹å‰çš„è¿è¡Œ
- é¿å…é‡å¤æ‰§è¡Œï¼ŒèŠ‚çœèµ„æº

**è¿è¡Œæ—¶é—´**ï¼šçº¦ 2-3 åˆ†é’Ÿ

---

## ğŸš€ ä½¿ç”¨è¯´æ˜

### æŸ¥çœ‹ CI çŠ¶æ€

1. **åœ¨ PR é¡µé¢**ï¼š
   - æŸ¥çœ‹ "Checks" æ ‡ç­¾
   - æ‰€æœ‰æ£€æŸ¥å¿…é¡»é€šè¿‡æ‰èƒ½åˆå¹¶

2. **åœ¨ Actions é¡µé¢**ï¼š
   - è®¿é—® `https://github.com/calvin-lai-0211/script-to-storyboards/actions`
   - æŸ¥çœ‹è¯¦ç»†çš„è¿è¡Œæ—¥å¿—

### æœ¬åœ°è¿è¡Œç›¸åŒæ£€æŸ¥

```bash
# å‰ç«¯æ£€æŸ¥ï¼ˆä¸ CI å®Œå…¨ç›¸åŒï¼‰
cd frontend
pnpm run test:run         # è¿è¡Œæµ‹è¯•
pnpm exec tsc --noEmit    # ç±»å‹æ£€æŸ¥
pnpm run lint             # ä»£ç æ£€æŸ¥
pnpm run build            # æ„å»ºéªŒè¯
```

### å¹¶å‘æ§åˆ¶

- âœ… **åŒä¸€ PR å¤šæ¬¡ push**ï¼šè‡ªåŠ¨å–æ¶ˆæ—§çš„è¿è¡Œï¼Œåªæ‰§è¡Œæœ€æ–°çš„
- âœ… **ä¸åŒ PR**ï¼šå¹¶è¡Œæ‰§è¡Œï¼Œäº’ä¸å½±å“
- âœ… **èŠ‚çœèµ„æº**ï¼šé¿å…é‡å¤æ£€æŸ¥

### è·³è¿‡ CIï¼ˆç´§æ€¥æƒ…å†µï¼‰

åœ¨ commit æ¶ˆæ¯ä¸­æ·»åŠ  `[skip ci]` æˆ– `[ci skip]`ï¼š

```bash
git commit -m "docs: update README [skip ci]"
```

âš ï¸ **ä¸æ¨è**ï¼šè·³è¿‡ CI å¯èƒ½å¯¼è‡´æœªæ£€æµ‹åˆ°çš„é—®é¢˜

---

## ğŸ“Š CI æ£€æŸ¥å¯¹åº”å…³ç³»

| CI æ£€æŸ¥ | æœ¬åœ° Pre-commit Hook | è¯´æ˜ |
|---------|---------------------|------|
| Run tests | `pnpm run test:run` | è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯• |
| Type check | `pnpm exec tsc --noEmit` | TypeScript ç±»å‹æ£€æŸ¥ |
| Lint | `pnpm run lint` | ESLint ä»£ç è§„èŒƒæ£€æŸ¥ |
| Build check | `pnpm run build` | éªŒè¯æ„å»ºæ˜¯å¦æˆåŠŸ |

---

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### å¹¶å‘æ§åˆ¶

```yaml
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true
```

- åŒä¸€ PR çš„æ–° push ä¼šå–æ¶ˆæ—§çš„è¿è¡Œ
- åŸºäº PR å·æˆ– ref è¿›è¡Œåˆ†ç»„

### ç¯å¢ƒå˜é‡

```yaml
env:
  VITE_API_BASE_URL: http://localhost:8001
```

### ç¼“å­˜ç­–ç•¥

- **Node modules**: ä½¿ç”¨ pnpm ç¼“å­˜
- **ä¾èµ–é”å®š**: ä½¿ç”¨ `--frozen-lockfile` ç¡®ä¿ä¸€è‡´æ€§

### è¿è¡Œç¯å¢ƒ

- **OS**: Ubuntu Latest
- **Node**: 20.x
- **pnpm**: 8.x

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¼šæœ‰å¤šä¸ª workflow åŒæ—¶è¿è¡Œï¼Ÿ

**ç­”**ï¼šå·²ä¼˜åŒ–ï¼ç°åœ¨ä½¿ç”¨å¹¶å‘æ§åˆ¶ï¼š
- åŒä¸€ PR çš„å¤šæ¬¡ push ä¼šè‡ªåŠ¨å–æ¶ˆæ—§çš„è¿è¡Œ
- åªä¿ç•™æœ€æ–°çš„æ£€æŸ¥

### Q: CI å¤±è´¥ä½†æœ¬åœ°é€šè¿‡ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
1. ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´ â†’ ä½¿ç”¨ `pnpm install --frozen-lockfile`
2. ç¯å¢ƒå˜é‡ç¼ºå¤± â†’ æ£€æŸ¥ workflow ä¸­çš„ `env` é…ç½®
3. ç¼“å­˜é—®é¢˜ â†’ åœ¨ Actions é¡µé¢æ¸…é™¤ç¼“å­˜

### Q: å¦‚ä½•æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„æ£€æŸ¥ï¼Ÿ

1. è®¿é—® PR é¡µé¢çš„ "Checks" æ ‡ç­¾
2. ç‚¹å‡»å…·ä½“çš„æ£€æŸ¥æŸ¥çœ‹å®æ—¶æ—¥å¿—
3. å¤±è´¥æ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### Q: å¦‚ä½•é‡æ–°è¿è¡Œå¤±è´¥çš„æ£€æŸ¥ï¼Ÿ

åœ¨ PR é¡µé¢ç‚¹å‡» "Re-run jobs" æŒ‰é’®

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GitHub Actions æ–‡æ¡£](https://docs.github.com/actions)
- [pnpm CI é…ç½®](https://pnpm.io/continuous-integration)
- [Pre-commit Hooks](../../.githooks/README.md)
- [å¹¶å‘æ§åˆ¶æ–‡æ¡£](https://docs.github.com/en/actions/using-jobs/using-concurrency)
