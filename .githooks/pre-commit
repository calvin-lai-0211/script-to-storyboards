#!/bin/sh
# Pre-commit hook for frontend code quality checks
# This hook runs tests, type-check, and linting before allowing commits

echo "üîç Running pre-commit checks..."

# Find the git root directory
GIT_ROOT=$(git rev-parse --show-toplevel)

# Change to frontend directory
cd "$GIT_ROOT/frontend" || exit 1

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to print colored messages
print_error() {
    echo "${RED}‚ùå $1${NC}"
}

print_success() {
    echo "${GREEN}‚úÖ $1${NC}"
}

print_info() {
    echo "${YELLOW}‚ÑπÔ∏è  $1${NC}"
}

# 1. Run tests
print_info "Running tests..."
if ! npm run test:run; then
    print_error "Tests failed! Please fix the failing tests before committing."
    exit 1
fi
print_success "Tests passed"

# 2. Run type-check
print_info "Running type-check..."
if ! npx tsc --noEmit; then
    print_error "Type-check failed! Please fix type errors before committing."
    exit 1
fi
print_success "Type-check passed"

# 3. Run lint
print_info "Running lint..."
if ! npm run lint; then
    print_error "Linting failed! Please fix lint errors before committing."
    print_info "You can run 'npm run lint:fix' to auto-fix some issues."
    exit 1
fi
print_success "Lint passed"

# All checks passed
print_success "All pre-commit checks passed! üéâ"
exit 0
