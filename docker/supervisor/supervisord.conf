[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

[program:api]
command=python -m uvicorn api.main:app --host 0.0.0.0 --port 8000
directory=/app
autostart=true
autorestart=true
startretries=5
stderr_logfile=/var/log/supervisor/api.err.log
stdout_logfile=/var/log/supervisor/api.out.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
priority=1
stopwaitsecs=30
stopsignal=TERM

[program:task-processor]
command=python background/task_processor.py
directory=/app
autostart=true
autorestart=true
startretries=10
stderr_logfile=/var/log/supervisor/task-processor.err.log
stdout_logfile=/var/log/supervisor/task-processor.out.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
priority=2
stopwaitsecs=30
stopsignal=TERM
# 如果 task processor 启动失败，不影响整个服务
startsecs=5
# 崩溃后等待 5 秒再重启
autorestart=unexpected
exitcodes=0
